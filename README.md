# 統合政府 財政シミュレーター（30〜50年）

2026年から最大2075年までの30〜50年間における、日本政府と日本銀行を一体とした「統合政府」の財政推移をシミュレーションするインタラクティブWebアプリケーションです。

## 概要

日本の財政を「政府＋日銀」の統合バランスシートで捉え、金利・インフレ・為替・貿易・人的資本・人口動態・家計への波及効果まで一貫してシミュレーションします。パラメータをスライダーで自由に調整し、10種類のプリセットシナリオと比較しながら、日本財政の将来像を探ることができます。

## 主な機能

### シミュレーション
- **税収モデル**: 消費税・所得税・法人税・その他税の4区分で個別に推計
- **日銀会計**: 国債保有利回りと当座預金付利の差（逆ザヤ）を追跡、累積損失と自己資本バッファを考慮
- **債務動態**: 9年借換ロジックによる平均クーポン推移、利払負担率の算出
- **内生為替モデル**: 金利差（α=0.5）・インフレ差（β=0.3）・リスクプレミアム（γ=0.5）の3要因から為替レートを内生的に決定
- **貿易収支**: 為替レート変動 → 輸出入額 → 貿易収支の連鎖シミュレーション
- **対外純資産（NFA）**: 経常収支の累積でNFAを追跡、通貨信任リスクの非線形加速メカニズム搭載
- **家計インパクト**: 内生賃金モデル（生産性分配率・インフレ転嫁率）、実質賃金・貧困率・ジニ係数の推計
- **モデル家計**: 年収400万円世帯の可処分所得・食費・光熱費の変化を具体的に表示
- **人的資本・人口動態**: 教育投資パイプライン（15年ラグ）、内生的出生率（TFR）、社会活力指数
- **企業セクター**: 法人税から企業利益を逆算、内部留保の累積・還元率の追跡
- **エネルギー補助金**: CPI＋円安連動の動的補助金モデル

### 10種類のプリセットシナリオ
1. ベースライン（現状維持） — D評価
2. 高成長シナリオ — B+評価
3. スタグフレーション — D評価
4. 金利急騰シナリオ — D評価
5. 財政再建シナリオ — A+評価
6. 急激円安シナリオ — D評価
7. 少子化加速シナリオ — D評価
8. テクノロジー革命 — B+評価
9. グローバル危機 — D評価
10. 再分配強化 — A+評価

### 3タブ構成
1. **解説タブ**: 計算ロジックツリー（A〜J）、統合政府フロー図（SVG）、日銀納付金・金利感応度グラフ、ウォーターフォール分析、データ出典
2. **シミュレーションタブ**: インタラクティブなチャート群（財政・家計・人口・貿易・日銀・GDP・企業セクター）とデータ表
3. **シナリオ一覧タブ**: 棒グラフ・レーダーチャート・折れ線推移・サマリー表・展開式カードによる横断比較

### URL共有機能
パラメータの状態をURLクエリパラメータにシリアライズし、「共有URLをコピー」ボタンでリンクを生成できます。デフォルト値と異なるパラメータのみをURLに含めるため、URLが短く保たれます。

### 最適化機能
勾配降下法を用いた警告数最小化パラメータ探索。制約条件（貧困率・ジニ係数・利払負担率・実質政策経費指数・経常赤字連続年数）のレッドラインを設定可能。

## 技術スタック

| 技術 | 用途 |
|------|------|
| React 19 | UI フレームワーク |
| TypeScript | 型安全なコード |
| Vite | ビルドツール |
| Recharts | チャート描画 |
| Streamlit | 配信ラッパー（開発環境） |

## プロジェクト構成

```
src/
├── App.tsx                  # ルートコンポーネント（3タブ構成）
├── main.tsx                 # エントリポイント
├── index.css                # CSSエントリポイント（@import経由）
│
├── types.ts                 # 全型定義（SimParams, SimResult等）
├── constants.ts             # デフォルト制約・データ出典
├── historicalData.ts        # 実績データ（財政・マクロ・教育・TFR）
├── scenarios.ts             # 10シナリオ定義
├── data.ts                  # バレル再エクスポート
│
├── simulation.ts            # シミュレーションエンジン（ロジックツリーA〜J）
├── warnings.ts              # 財政リスク警告検出
├── optimizer.ts             # 勾配降下法パラメータ最適化
├── utils.ts                 # 汎用ユーティリティ
│
├── SimulationTab.tsx         # シミュレーション結果表示タブ
├── ExplanationTab.tsx        # 解説タブ
├── ScenariosTab.tsx          # シナリオ一覧・横断比較タブ
├── Sidebar.tsx               # パラメータ入力サイドバー
│
├── components/
│   ├── ChartHelp.tsx         # チャートヘルプツールチップ
│   ├── Collapsible.tsx       # 折りたたみUIコンポーネント
│   ├── WarningAccordion.tsx  # 警告アコーディオン
│   ├── ui/
│   │   ├── Slider.tsx        # 汎用スライダー
│   │   ├── NumberInput.tsx   # 汎用数値入力
│   │   └── SidebarSection.tsx # 折りたたみセクション
│   └── sidebar/
│       ├── SidebarMiniChart.tsx # 金利・教育投資ミニチャート
│       └── ConstraintRow.tsx    # 制約条件行
│
├── hooks/
│   ├── useOptimizer.ts       # 最適化ロジックフック
│   └── useUrlParams.ts       # URL共有フック
│
├── styles/
│   ├── base.css              # リセット・CSS変数
│   ├── layout.css            # タブ・グリッド
│   ├── sidebar.css           # サイドバー
│   ├── charts.css            # チャート・データテーブル
│   ├── scenarios.css         # シナリオ一覧
│   └── components.css        # 汎用UIパーツ
│
└── svg/
    └── FlowDiagram.tsx       # 統合政府フロー図（SVG）

app.py                        # Streamlit配信ラッパー
vite.config.ts                # Vite設定
```

## シミュレーションロジック概要

### A: マクロ経済
名目成長率 = インフレ率 + 実質成長率。人的資本補正と社会活力ブーストを加算。

### B: リスクプレミアム
通貨リスク（NFA悪化加速メカニズム）＋ 財政リスク（利払負担率閾値超過時に自動加算）。

### C: 人的資本・労働力
教育投資パイプライン（15年ラグ）＋ テクノロジー効果 − 高齢化ペナルティ。

### D: 出生率・社会活力
内生TFR = ベースTFR + 賃金効果 + 格差効果 + 子育て支援効果（20年ラグで人口にフィードバック）。

### E: 金利・日銀
市場金利 = 名目成長率 + リスクプレミアム群。日銀BS縮小（QT）・利回り追随（9年借換）。

### F: 為替・貿易
為替 = バイアス + 0.5×金利差 + 0.3×インフレ差 + 0.5×リスクP。NFA・経常収支の追跡。

### G: 税収
- **消費税**: 前年 × (1 + インフレ率) ※税率変更年度に調整
- **所得税**: 前年 × (1 + (名目成長率×0.5 + 賃金×0.5) × 1.4) × 人的資本乗数
- **法人税**: 前年 × (1 + 実質成長率×2.0 + インフレ率×0.5) × 為替効果
- **その他税**: 前年 × (1 + 名目成長率 × 0.8)

### H: 物価・賃金・格差
内生賃金 = 実質成長率×分配率 + インフレ率×転嫁率 + 人的資本成長×0.3。貧困率・ジニ係数の動的推計。

### I: 歳出
社会保障（インフレ連動＋自然増＋人口圧力）、子育て・防衛・エネルギー補助金の個別推計。

### J: 家計モデル
年収400万円世帯の可処分所得 = 収入×(1−負担率) − 食費 − 光熱費 − 消費税負担。

## ビルド・開発

```bash
# 開発サーバー起動
npx vite --host 0.0.0.0 --port 5001

# プロダクションビルド
npx vite build

# Streamlit経由で配信（ポート5000）
streamlit run app.py --server.port 5000
```

ビルド後の `dist/index.html` は単体で動作するため、GitHub Pages やブログ記事への埋め込みにも対応しています。

## データ出典

- **財務省**: 税収実績、歳出決算、国債費、利払い費、貿易統計
- **総務省統計局**: GDP、CPI、マクロ経済指標
- **厚生労働省**: 相対的貧困率、所得分布、人口動態統計
- **日本銀行**: 金融政策、国債保有残高、当座預金残高
- **FRED**: 米国10年国債利回り
- **BLS**: 米国消費者物価指数
- **OECD**: Education at a Glance（教育投資GDP比）
- **国立社会保障・人口問題研究所**: 出生率・人口推計

## ライセンス

MIT
