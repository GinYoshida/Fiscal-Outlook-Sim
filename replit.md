# 統合政府 30年財政シミュレーター

## Overview
2026〜2055年の30年間における、日本政府と日本銀行を一体とした「統合政府」の財政推移をシミュレーションするReact + TypeScriptアプリ。貿易収支（為替の逆累進性）と家計への影響（貧困率・ジニ係数）のシミュレーションを含む。

## Architecture
- **src/**: React + TypeScript ソースコード
  - **src/main.tsx**: エントリーポイント
  - **src/App.tsx**: メインアプリケーション（タブ切替・状態管理）
  - **src/data.ts**: 実績データ・シナリオ・型定義
  - **src/simulation.ts**: シミュレーションロジック（runSimulation関数）
  - **src/Sidebar.tsx**: サイドバーUI（パラメータ調整）
  - **src/SimulationTab.tsx**: シミュレーションタブ（チャート・データ表）
  - **src/ExplanationTab.tsx**: 解説タブ（目的・ロジック・ウォーターフォール）
  - **src/index.css**: グローバルスタイル
- **dist/**: Viteビルド出力（静的HTML/JS/CSS）
- **app.py**: Streamlitラッパー（dist/のReactアプリをインラインで配信）
- **vite.config.ts**: Vite設定
- **Stack**: React 19 + TypeScript + Vite + Recharts

## Tab Structure (2タブ構成)
1. **📖 解説タブ**: シミュレーターの目的、計算ロジックツリー（A〜E）、各変数の解説（5つのexpander: A歳入・B支出・C収支・D貿易・E家計）、統合政府の仕組み（フロー図・日銀納付金・金利感応度）、ウォーターフォール分析（Recharts積み上げ式）、データ出典
2. **📊 シミュレーションタブ**: メイン3チャート（利払負担率・財政収支・債務残高）常時表示、家計影響チャート（貧困率・ジニ係数・実質賃金）、貿易収支・為替レートチャート、折りたたみチャート（歳入内訳・支出合計・日銀納付金・金利成長率）、転置データ表（行=項目、列=年度、階層構造）

## Key Features
- サイドバーでパラメータ調整、各パラメータに[?]ヘルプツールチップ付き
- 6つのプリセットシナリオ（ベースライン、高成長、スタグフレーション、金利急騰、財政再建、急激円安）
- 消費税率変更シナリオ（年度指定で税率変更可能：なし/2030/2035/2040）
- 貿易収支シミュレーション（為替レート→輸出入→貿易収支）
- 家計インパクトシミュレーション（実質賃金→貧困率・ジニ係数）
- 政府会計フィードバック（法人税への円安効果、外貨準備評価益、エネルギー補助金）
- ウォーターフォール分析（Recharts積み上げBarChart、invisible base + colored bar方式）
- 転置データ表（貿易・家計データ含む、5年おき/全30年/実績切替）
- レスポンシブ対応（モバイル時サイドバー折りたたみ）

## Simulation Logic
- 税収（4区分）:
  - 消費税: 前年 × (1 + インフレ率 × 1.0) ※税率変更年度は (新税率/10) で調整
  - 所得税: 前年 × (1 + 名目成長率 × 1.4)
  - 法人税: 前年 × (1 + 実質成長率×2.0 + インフレ率×0.5) × (1 + 輸出利益 − 輸入コスト)
  - その他税: 前年 × (1 + 名目成長率 × 0.8)
- 日銀純利益 = 保有国債×利回り - 当座預金×政策金利（逆ザヤ許容）
  - 累積損失 > 自己資本バッファ → マイナスが歳入を直接減少
  - 累積損失 ≤ バッファ → max(純利益, 0)で吸収
- 政策経費: 前年 × (1 + インフレ率) + 自然増 + エネルギー補助金
- 平均クーポン: (前年×8/9) + (市場金利×1/9) ← 9年借換ロジック
- 貿易収支:
  - 為替: 前年 × (1 + 円安進行率)
  - 輸入: 前年 × (1+実質成長率) × (1+インフレ×円安係数)
  - 輸出: 前年 × (1+世界成長率) × (1+円安メリット)
- 家計インパクト:
  - CPI上昇 = インフレ率 + 円安コストプッシュ×0.3
  - 実質賃金伸び率 = 名目賃金上昇率 − CPI上昇
  - 貧困率 = 前年 × (1 + (CPI−賃金)差 × 感応度)
  - ジニ係数 = 前年 + (資産成長率 − 実質賃金伸び率) × 0.01

## Build & Development
- 開発: `npx vite --host 0.0.0.0 --port 5001` (ポート5000はStreamlitが使用)
- ビルド: `npx vite build` → dist/ に出力
- 配信: app.py がStreamlit経由でdist/の内容をインライン配信
- 将来: dist/index.html を単体でホスティング可能（GitHub Pages, Note埋め込み等）

## Data Sources
- 財務省: 税収、歳出、国債費、利払い費、貿易統計
- 総務省統計局: マクロ経済統計
- 厚生労働省: 貧困率・所得分布

## Recent Changes
- 2026-02-22: React + TypeScript + Viteに移行（Streamlitはラッパーとして維持）
- 2026-02-22: Rechartsベースのチャートに移行
- 2026-02-22: 2タブ構成（解説タブ + シミュレーションタブ）
- 2026-02-22: 転置データ表（行=項目の階層構造、列=年度）
- 2026-02-22: 消費税率変更シナリオ・国債発行額・その他収入4分割
- 2026-02-22: ウォーターフォールチャート修正（Recharts積み上げBarChart方式に変更）
- 2026-02-22: 貿易収支・為替シミュレーション追加（為替→輸出入→貿易収支）
- 2026-02-22: 家計インパクトシミュレーション追加（貧困率・ジニ係数・実質賃金）
- 2026-02-22: 政府会計フィードバック追加（法人税円安効果・外貨準備評価益・エネルギー補助金）
- 2026-02-22: 新シナリオ「⑥ 急激円安シナリオ」追加
- 2026-02-22: 解説タブにD:貿易収支、E:家計インパクトの計算ロジック解説追加
- 2026-02-22: モデル家計シミュレーション追加（年収400万円→可処分所得・食費・光熱費の変化）
- 2026-02-22: ジニ係数→所得格差倍率変換（(1+G)/(1-G)で五分位倍率）
- 2026-02-22: 日銀逆ザヤ対応（max(0)クリップ撤廃、累積損失追跡、自己資本バッファ超過時にマイナス納付金が歳入減）
- 2026-02-22: 金利感応度チャートをBarChartに変更（Line→Bar統一）
- 2026-02-22: 家計の実感チャート追加（可処分所得変化vs生活費増加、所得格差倍率推移）
- 2026-02-22: データ表にモデル家計・所得格差倍率を追加
- 2026-02-22: 対外純資産(NFA)追跡機能追加（経常収支=貿易収支+所得収支、NFA累積）
- 2026-02-22: 動的通貨リスクプレミアム（経常赤字+NFA防衛ライン割れで金利自動加算）
- 2026-02-22: サマリーパネル追加（30年シミュレーション結果概要＋警告イベントタイムライン）
- 2026-02-22: 対外純資産・経常収支チャート追加、データ表にNFA・経常収支・リスクプレミアム追加
- 2026-02-22: 解説タブにF:対外純資産と通貨信任リスクの計算ロジック解説追加
- 2026-02-22: 金利チャートを実効市場金利に変更（ベース金利+動的リスクプレミアム反映）
- 2026-02-22: パラメータ最適化機能追加（勾配降下法で警告数を最小化、サイドバーに探索UI）
