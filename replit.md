# 統合政府 30年財政シミュレーター

## Overview
2026〜2055年の30年間における、日本政府と日本銀行を一体とした「統合政府」の財政推移をシミュレーションするReact + TypeScriptアプリ。

## Architecture
- **src/**: React + TypeScript ソースコード
  - **src/main.tsx**: エントリーポイント
  - **src/App.tsx**: メインアプリケーション（タブ切替・状態管理）
  - **src/data.ts**: 実績データ・シナリオ・型定義
  - **src/simulation.ts**: シミュレーションロジック（runSimulation関数）
  - **src/Sidebar.tsx**: サイドバーUI（パラメータ調整）
  - **src/SimulationTab.tsx**: シミュレーションタブ（チャート・データ表）
  - **src/ExplanationTab.tsx**: 解説タブ（目的・ロジック・ウォーターフォール）
  - **src/index.css**: グローバルスタイル
- **dist/**: Viteビルド出力（静的HTML/JS/CSS）
- **app.py**: Streamlitラッパー（dist/のReactアプリをインラインで配信）
- **vite.config.ts**: Vite設定
- **Stack**: React 19 + TypeScript + Vite + Recharts
- **static/**: 旧React SPA版（未使用）

## Tab Structure (2タブ構成)
1. **📖 解説タブ**: シミュレーターの目的、計算ロジックツリー（code block）、各変数の解説（3つのexpander）、統合政府の仕組み（フロー図・日銀納付金・金利感応度、各expander）、ウォーターフォール分析、データ出典
2. **📊 シミュレーションタブ**: メイン3チャート（利払負担率・財政収支・債務残高）常時表示、折りたたみチャート（歳入内訳・支出合計・日銀納付金・金利成長率）、転置データ表（行=項目、列=年度、階層構造）

## Key Features
- サイドバーでパラメータ調整（インフレ率、成長率、リスクプレミアム等）、各パラメータに[?]ヘルプツールチップ付き
- 5つのプリセットシナリオ（ベースライン、高成長、スタグフレーション、金利急騰、財政再建）
- 消費税率変更シナリオ（年度指定で税率変更可能：なし/2030/2035/2040）
- 国債発行額の自動計算（max(歳出-歳入, 0)）
- その他収入の4項目分割（印紙収入30%・官業収入20%・資産売却25%・雑収入25%）
- 利払い負担率30%超過時の警告
- 転置データ表（行=項目の階層構造、列=5年おき年度 / 全30年 / 実績2015-2024）
- ウォーターフォール分析（2015〜2055年度対応、実績/シミュレーション切替）
- 統合政府の仕組み（資金フロー図、日銀納付金構造、金利感応度分析）
- 税収4区分シミュレーション（消費税・所得税・法人税・その他税を個別弾性値で推計）
- 実績データ（2015〜2024年度）と出典リンク
- レスポンシブ対応（モバイル時サイドバー折りたたみ）

## Simulation Logic
- 税収（4区分に分解）:
  - 消費税: 前年 × (1 + インフレ率 × 1.0) ※税率変更年度は (新税率/10) で調整
  - 所得税: 前年 × (1 + 名目成長率 × 1.4)
  - 法人税: 前年 × (1 + 実質成長率×2.0 + インフレ率×0.5)
  - その他税: 前年 × (1 + 名目成長率 × 0.8)
- 日銀納付金: max(保有国債×利回り - 当座預金×政策金利, 0)
- 政策経費: 前年 × (1 + インフレ率) + 自然増0.5兆円
- 平均クーポン: (前年×8/9) + (市場金利×1/9) ← 9年借換ロジック
- 債務残高: 前年 + (合計費用 - 合計収益)
- 国債発行額: max(歳出 - 歳入, 0)

## Build & Development
- 開発: `npx vite --host 0.0.0.0 --port 5001` (ポート5000はStreamlitが使用)
- ビルド: `npx vite build` → dist/ に出力
- 配信: app.py がStreamlit経由でdist/の内容をインライン配信
- 将来: dist/index.html を単体でホスティング可能（GitHub Pages, Note埋め込み等）

## Data Sources
- 財務省: 税収、歳出、国債費、利払い費データ
- 総務省統計局: マクロ経済統計

## Recent Changes
- 2026-02-22: React + TypeScript + Viteに移行（Streamlitはラッパーとして維持）
- 2026-02-22: Rechartsベースのチャートに移行
- 2026-02-22: 2タブ構成（解説タブ + シミュレーションタブ）
- 2026-02-22: 転置データ表（行=項目の階層構造、列=年度）
- 2026-02-22: 消費税率変更シナリオ・国債発行額・その他収入4分割
